"""
This script reads the docking_benchmark_dataset.csv file generated by
01_generate_benchmark_dataset.py and calculates a similarity matrix over all structures using the
KisSim fingerprint.
"""
from kissim.api import encode, compare
import pandas as pd


docking_benchmark_dataset = pd.read_csv("../data/docking_benchmark_dataset.csv", index_col=0)
print(f"Number of structures: {len(docking_benchmark_dataset)}")

print("Generating fingerprints ...")
fingerprint_generator = encode(
    structure_klifs_ids=docking_benchmark_dataset["structure.klifs_id"],
    n_cores=1,
)
print(f"Number of fingerprints: {len(fingerprint_generator.data.keys())}")

print("Comparing fingerprints ...")
feature_distances_generator, fingerprint_distance_generator = compare(
    fingerprint_generator=fingerprint_generator,
    output_path=None,
    feature_weights=[  #
        0, 0, 0, 0, 0, 0, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9
    ],
    n_cores=4,
)

print("Generating similarity matrix ...")
similarity_matrix = 1 - fingerprint_distance_generator.structure_distance_matrix()
similarity_matrix.index.names = [""]
similarity_matrix.columns.names = [""]

print("Saving results ...")
similarity_matrix.to_csv("../data/pocket_similarity_matrix.csv")

print("Finished!")
